import{_ as b,o as a,c,a as t,t as d,f as F,n as R,v as z,q as G,j as v,e as H,g as J,F as D,p as B,w as P,b as U,r as Q,h as W,i as A,l as g,d as L,k as X,u as Y,s as Z}from"./index-C4P4iVt1.js";import{c as tt,p as q}from"./api-DGvhhBH4.js";const et={class:"comment-item"},st=["src","alt"],ot={class:"comment-bubble"},at={class:"comment-author"},nt={class:"comment-content"},rt="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",ct={__name:"CommentItem",props:{comment:{type:Object,required:!0}},setup(u){return(_,p)=>{var l,o,n;return a(),c("div",et,[t("img",{src:((l=u.comment.author)==null?void 0:l.coverImage)||rt,alt:(o=u.comment.author)==null?void 0:o.userName,class:"comment-avatar"},null,8,st),t("div",ot,[t("span",at,d(((n=u.comment.author)==null?void 0:n.userName)||"åŒ¿åç”¨æˆ¶"),1),t("p",nt,d(u.comment.content),1)])])}}},lt=b(ct,[["__scopeId","data-v-c49f8248"]]),it={class:"comment-box"},ut=["disabled"],dt={__name:"CommentBox",props:{postId:{type:[Number,String],required:!0}},emits:["commentCreated"],setup(u,{emit:_}){const p=u,l=_,o=v(""),n=v(!1),e=F();async function m(){if(!(!o.value.trim()||n.value)){n.value=!0;try{const i=await tt.createComment({postId:Number(p.postId),content:o.value});i.data.status==="SUCCESS"?(e.showSuccess(["ç•™è¨€æˆåŠŸï¼"]),o.value="",l("commentCreated")):e.showError(i.data.message||["ç•™è¨€å¤±æ•—"])}catch{e.showError(["ç•™è¨€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦"])}finally{n.value=!1}}}return(i,h)=>(a(),c("div",it,[R(t("input",{"onUpdate:modelValue":h[0]||(h[0]=f=>o.value=f),type:"text",placeholder:"å¯«ä¸‹ä½ çš„ç•™è¨€...",class:"comment-input",onKeyup:G(m,["enter"])},null,544),[[z,o.value]]),t("button",{class:"btn btn-primary comment-btn",disabled:!o.value.trim()||n.value,onClick:m},d(n.value?"é€å‡ºä¸­...":"ç•™è¨€"),9,ut)]))}},mt=b(dt,[["__scopeId","data-v-1396b960"]]),pt={class:"post-detail-page"},vt={class:"container"},_t={key:0,class:"loading-state"},ht={class:"post-card"},ft={class:"post-header"},gt={class:"author-info"},bt=["src","alt"],yt={class:"author-name"},kt={key:0,class:"post-actions"},Ct=["disabled"],wt={class:"post-body"},Vt={class:"post-content-wrapper"},St={key:0,class:"post-image-section"},xt=["src"],It={class:"post-text-section"},Nt={class:"post-content"},$t={class:"comments-section"},Et={class:"comments-title"},Dt={key:0,class:"no-comments"},Bt={key:1,class:"comments-list"},Pt={key:3,class:"login-prompt"},Ut={key:2,class:"error-state"},At="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",Lt={__name:"PostDetailView",setup(u){const _=Z(),p=Y(),l=H(),o=F(),n=L(()=>_.params.id),e=v(null),m=v(!0),i=v(!1),h=L(()=>{var r,s;return!l.user||!((s=(r=e.value)==null?void 0:r.postVo)!=null&&s.author)?!1:l.user.id===e.value.postVo.author.id||l.user.userName===e.value.postVo.author.userName});async function f(){m.value=!0;try{const r=await q.getPostDetail(n.value);r.data.status==="SUCCESS"?e.value=r.data.data:o.showError(r.data.message||["è¼‰å…¥è²¼æ–‡å¤±æ•—"])}catch(r){console.error("Failed to fetch post:",r),o.showError(["è¼‰å…¥è²¼æ–‡å¤±æ•—"])}finally{m.value=!1}}async function T(){if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç¯‡è²¼æ–‡å—ï¼Ÿ")){i.value=!0;try{const r=await q.deletePost(n.value);r.data.status==="SUCCESS"?(o.showSuccess(["è²¼æ–‡å·²åˆªé™¤"]),p.push("/")):o.showError(r.data.message||["åˆªé™¤å¤±æ•—"])}catch{o.showError(["åˆªé™¤å¤±æ•—"])}finally{i.value=!1}}}function j(){f()}function K(){p.push("/")}return J(()=>{f()}),(r,s)=>{var k,C,w,V,S,x,I,N,$,E;const y=X("router-link");return a(),c("div",pt,[t("div",vt,[t("button",{class:"btn btn-secondary back-btn",onClick:K}," â† è¿”å› "),m.value?(a(),c("div",_t,[...s[0]||(s[0]=[t("div",{class:"spinner"},null,-1),t("p",null,"è¼‰å…¥ä¸­...",-1)])])):e.value?(a(),c(D,{key:1},[t("div",ht,[t("div",ft,[t("div",gt,[t("img",{src:((C=(k=e.value.postVo)==null?void 0:k.author)==null?void 0:C.coverImage)||At,alt:(V=(w=e.value.postVo)==null?void 0:w.author)==null?void 0:V.userName,class:"author-avatar"},null,8,bt),t("div",null,[t("span",yt,d(((x=(S=e.value.postVo)==null?void 0:S.author)==null?void 0:x.userName)||"åŒ¿åç”¨æˆ¶"),1)])]),h.value?(a(),c("div",kt,[B(y,{to:`/post/${n.value}/edit`,class:"btn btn-secondary"},{default:P(()=>[...s[1]||(s[1]=[g(" âœï¸ ç·¨è¼¯ ",-1)])]),_:1},8,["to"]),t("button",{class:"btn btn-danger",onClick:T,disabled:i.value},d(i.value?"åˆªé™¤ä¸­...":"ğŸ—‘ï¸ åˆªé™¤"),9,Ct)])):U("",!0)]),t("div",wt,[t("div",Vt,[(I=e.value.postVo)!=null&&I.image?(a(),c("div",St,[t("img",{src:e.value.postVo.image,alt:"Post image",class:"post-image"},null,8,xt)])):U("",!0),t("div",It,[t("p",Nt,d((N=e.value.postVo)==null?void 0:N.content),1)])])])]),t("div",$t,[t("h3",Et,"ğŸ’¬ ç•™è¨€å€ ("+d((($=e.value.commentVoList)==null?void 0:$.length)||0)+")",1),((E=e.value.commentVoList)==null?void 0:E.length)===0?(a(),c("div",Dt,[...s[2]||(s[2]=[t("p",null,"é‚„æ²’æœ‰ç•™è¨€ï¼Œæˆç‚ºç¬¬ä¸€å€‹ç•™è¨€çš„äººå§ï¼",-1)])])):(a(),c("div",Bt,[(a(!0),c(D,null,Q(e.value.commentVoList,(M,O)=>(a(),A(lt,{key:O,comment:M},null,8,["comment"]))),128))])),W(l).isLoggedIn?(a(),A(mt,{key:2,"post-id":n.value,onCommentCreated:j},null,8,["post-id"])):(a(),c("div",Pt,[t("p",null,[s[4]||(s[4]=g("è«‹ ",-1)),B(y,{to:"/login"},{default:P(()=>[...s[3]||(s[3]=[g("ç™»å…¥",-1)])]),_:1}),s[5]||(s[5]=g(" å¾Œæ‰èƒ½ç•™è¨€",-1))])]))])],64)):(a(),c("div",Ut,[...s[6]||(s[6]=[t("p",null,"æ‰¾ä¸åˆ°è²¼æ–‡",-1)])]))])])}}},Tt=b(Lt,[["__scopeId","data-v-7903f317"]]);export{Tt as default};
