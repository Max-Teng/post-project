import{_ as g,o,c as u,a as t,t as d,f as F,n as G,v as H,q as J,j as f,i as b,w as k,m as Q,T as W,e as X,g as Y,b as C,F as U,p as A,r as Z,h as tt,l as h,d as L,k as et,u as st,s as ot}from"./index-eZ7eEyX8.js";import{c as at,p as q}from"./api-DIZqW3Cv.js";const nt={class:"comment-item"},lt=["src","alt"],rt={class:"comment-bubble"},ct={class:"comment-author"},it={class:"comment-content"},ut="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",dt={__name:"CommentItem",props:{comment:{type:Object,required:!0}},setup(c){return(v,n)=>{var i,a,l;return o(),u("div",nt,[t("img",{src:((i=c.comment.author)==null?void 0:i.coverImage)||ut,alt:(a=c.comment.author)==null?void 0:a.userName,class:"comment-avatar"},null,8,lt),t("div",rt,[t("span",ct,d(((l=c.comment.author)==null?void 0:l.userName)||"åŒ¿åç”¨æˆ¶"),1),t("p",it,d(c.comment.content),1)])])}}},mt=g(dt,[["__scopeId","data-v-c49f8248"]]),vt={class:"comment-box"},pt=["disabled"],_t={__name:"CommentBox",props:{postId:{type:[Number,String],required:!0}},emits:["commentCreated"],setup(c,{emit:v}){const n=c,i=v,a=f(""),l=f(!1),s=F();async function _(){if(!(!a.value.trim()||l.value)){l.value=!0;try{const m=await at.createComment({postId:Number(n.postId),content:a.value});m.data.status==="SUCCESS"?(s.showSuccess(["ç•™è¨€æˆåŠŸï¼"]),a.value="",i("commentCreated")):s.showError(m.data.message||["ç•™è¨€å¤±æ•—"])}catch{s.showError(["ç•™è¨€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦"])}finally{l.value=!1}}}return(m,p)=>(o(),u("div",vt,[G(t("input",{"onUpdate:modelValue":p[0]||(p[0]=y=>a.value=y),type:"text",placeholder:"å¯«ä¸‹ä½ çš„ç•™è¨€...",class:"comment-input",onKeyup:J(_,["enter"])},null,544),[[H,a.value]]),t("button",{class:"btn btn-primary comment-btn",disabled:!a.value.trim()||l.value,onClick:_},d(l.value?"é€å‡ºä¸­...":"ç•™è¨€"),9,pt)]))}},ft=g(_t,[["__scopeId","data-v-1396b960"]]),ht={class:"modal-container"},bt={class:"modal-header"},gt={class:"modal-title"},yt={class:"modal-body"},Ct={class:"modal-footer"},kt={__name:"ConfirmModal",props:{title:{type:String,default:"ç¢ºèªå‹•ä½œ"},message:{type:String,required:!0},confirmText:{type:String,default:"ç¢ºèª"},cancelText:{type:String,default:"å–æ¶ˆ"}},emits:["confirm","cancel"],setup(c){return(v,n)=>(o(),b(W,{name:"modal"},{default:k(()=>[t("div",{class:"modal-overlay",onClick:n[2]||(n[2]=Q(i=>v.$emit("cancel"),["self"]))},[t("div",ht,[t("div",bt,[n[3]||(n[3]=t("div",{class:"icon-wrapper"}," âš ï¸ ",-1)),t("h3",gt,d(c.title),1)]),t("div",yt,[t("p",null,d(c.message),1)]),t("div",Ct,[t("button",{class:"btn btn-secondary",onClick:n[0]||(n[0]=i=>v.$emit("cancel"))},d(c.cancelText),1),t("button",{class:"btn btn-danger",onClick:n[1]||(n[1]=i=>v.$emit("confirm"))},d(c.confirmText),1)])])])]),_:1}))}},$t=g(kt,[["__scopeId","data-v-3abba188"]]),wt={class:"post-detail-page"},St={class:"container"},Vt={key:1,class:"loading-state"},xt={class:"post-card"},It={class:"post-header"},Nt={class:"author-info"},Dt=["src","alt"],Et={class:"author-name"},Tt={key:0,class:"post-actions"},Bt=["disabled"],Pt={class:"post-body"},Mt={class:"post-content-wrapper"},Ut={key:0,class:"post-image-section"},At=["src"],Lt={class:"post-text-section"},qt={class:"post-content"},Ft={class:"comments-section"},jt={class:"comments-title"},Kt={key:0,class:"no-comments"},Ot={key:1,class:"comments-list"},Rt={key:3,class:"login-prompt"},zt={key:3,class:"error-state"},Gt="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",Ht={__name:"PostDetailView",setup(c){const v=ot(),n=st(),i=X(),a=F(),l=L(()=>v.params.id),s=f(null),_=f(!0),m=f(!1),p=f(!1),y=L(()=>{var r,e;return!i.user||!((e=(r=s.value)==null?void 0:r.postVo)!=null&&e.author)?!1:i.user.id===s.value.postVo.author.id||i.user.userName===s.value.postVo.author.userName});async function $(){_.value=!0;try{const r=await q.getPostDetail(l.value);r.data.status==="SUCCESS"?s.value=r.data.data:a.showError(r.data.message||["è¼‰å…¥è²¼æ–‡å¤±æ•—"])}catch(r){console.error("Failed to fetch post:",r),a.showError(["è¼‰å…¥è²¼æ–‡å¤±æ•—"])}finally{_.value=!1}}async function j(){p.value=!0}async function K(){p.value=!1,m.value=!0;try{const r=await q.deletePost(l.value);r.data.status==="SUCCESS"?(a.showSuccess(["è²¼æ–‡å·²åˆªé™¤"]),n.push("/")):a.showError(r.data.message||["åˆªé™¤å¤±æ•—"])}catch{a.showError(["åˆªé™¤å¤±æ•—"])}finally{m.value=!1}}function O(){$()}function R(){n.push("/")}return Y(()=>{$()}),(r,e)=>{var S,V,x,I,N,D,E,T,B,P;const w=et("router-link");return o(),u("div",wt,[t("div",St,[t("button",{class:"btn btn-secondary back-btn",onClick:R}," â† è¿”å› "),p.value?(o(),b($t,{key:0,title:"åˆªé™¤è²¼æ–‡",message:"ç¢ºå®šè¦åˆªé™¤é€™ç¯‡è²¼æ–‡å—ï¼Ÿåˆªé™¤å¾Œç„¡æ³•æ¢å¾©ã€‚","confirm-text":"ç¢ºèªåˆªé™¤","cancel-text":"å–æ¶ˆ",onConfirm:K,onCancel:e[0]||(e[0]=M=>p.value=!1)})):C("",!0),_.value?(o(),u("div",Vt,[...e[1]||(e[1]=[t("div",{class:"spinner"},null,-1),t("p",null,"è¼‰å…¥ä¸­...",-1)])])):s.value?(o(),u(U,{key:2},[t("div",xt,[t("div",It,[t("div",Nt,[t("img",{src:((V=(S=s.value.postVo)==null?void 0:S.author)==null?void 0:V.coverImage)||Gt,alt:(I=(x=s.value.postVo)==null?void 0:x.author)==null?void 0:I.userName,class:"author-avatar"},null,8,Dt),t("div",null,[t("span",Et,d(((D=(N=s.value.postVo)==null?void 0:N.author)==null?void 0:D.userName)||"åŒ¿åç”¨æˆ¶"),1)])]),y.value?(o(),u("div",Tt,[A(w,{to:`/post/${l.value}/edit`,class:"btn btn-secondary"},{default:k(()=>[...e[2]||(e[2]=[h(" âœï¸ ç·¨è¼¯ ",-1)])]),_:1},8,["to"]),t("button",{class:"btn btn-danger",onClick:j,disabled:m.value},d(m.value?"åˆªé™¤ä¸­...":"ğŸ—‘ï¸ åˆªé™¤"),9,Bt)])):C("",!0)]),t("div",Pt,[t("div",Mt,[(E=s.value.postVo)!=null&&E.image?(o(),u("div",Ut,[t("img",{src:s.value.postVo.image,alt:"Post image",class:"post-image"},null,8,At)])):C("",!0),t("div",Lt,[t("p",qt,d((T=s.value.postVo)==null?void 0:T.content),1)])])])]),t("div",Ft,[t("h3",jt,"ğŸ’¬ ç•™è¨€å€ ("+d(((B=s.value.commentVoList)==null?void 0:B.length)||0)+")",1),((P=s.value.commentVoList)==null?void 0:P.length)===0?(o(),u("div",Kt,[...e[3]||(e[3]=[t("p",null,"é‚„æ²’æœ‰ç•™è¨€ï¼Œæˆç‚ºç¬¬ä¸€å€‹ç•™è¨€çš„äººå§ï¼",-1)])])):(o(),u("div",Ot,[(o(!0),u(U,null,Z(s.value.commentVoList,(M,z)=>(o(),b(mt,{key:z,comment:M},null,8,["comment"]))),128))])),tt(i).isLoggedIn?(o(),b(ft,{key:2,"post-id":l.value,onCommentCreated:O},null,8,["post-id"])):(o(),u("div",Rt,[t("p",null,[e[5]||(e[5]=h("è«‹ ",-1)),A(w,{to:"/login"},{default:k(()=>[...e[4]||(e[4]=[h("ç™»å…¥",-1)])]),_:1}),e[6]||(e[6]=h(" å¾Œæ‰èƒ½ç•™è¨€",-1))])]))])],64)):(o(),u("div",zt,[...e[7]||(e[7]=[t("p",null,"æ‰¾ä¸åˆ°è²¼æ–‡",-1)])]))])])}}},Wt=g(Ht,[["__scopeId","data-v-84c4bc6e"]]);export{Wt as default};
